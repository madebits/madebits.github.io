#Moving Ubuntu Hard Disk to a New Machine

2014-11-08

<!--- tags: linux windows -->

I moved my hard disk with Lubuntu from my Asus machine to a Dell machine and Lubuntu run there almost without any changes. I encountered a few minor issues during the new setup.

* I got first a Grub failure message, `error: unknown filesystem. grub rescue>`. The disk was recognized, but somehow Grub was getting confused what to do next. This was related to two separate problems having nothing to do with Grub:
	1. I had to change SATA mode in BIOS to match the one of my previous Asus machine.
	1. I have an external hard disk connected to a USB port (that I mount in fstab). Somehow it was recognized as first disk and Grub was trying to map its settings to that disk. Removing that external hardisk, worked (Grub rescue was showing the right partitions on `ls` command). I wanted to have the external hard disk connected to the USB port all the time and not to remember to remove it before booting and connect it after. After some trial and error, I found that I have to disable the Onboard NIC in Dell BIOS as a possible system startup source. I am not sure how these are related, but it is reproducible.
After these, I could boot to the Grub menu (I have dual-boot system in this hard-disk with (L)Ubuntu and Windows 7 using Grub as boot manager).
* I was not using any proprietary graphics driver, so the graphics run without any problems. Asus was using ATI Radeon and Dell has a nVidia card, and the open source driver worked for me out of the box without me having to do anything. Given my graphics requirements are not so high (I only care about resolution and that works fine on full HD), I will keep the open source [nouveau](https://help.ubuntu.com/community/BinaryDriverHowto/Nvidia) driver. The only thing it cannot handle is the hardware video decoding. This is not a big issue and I can live without that.
* My Ethernet and WLAN were named eth1 and wlan1 in the new machine. This is related to the udev net persistent [rules](http://ubuntuforums.org/showthread.php?t=1007285). I had to edit `/etc/udev/rules.d/70-persistent-net.rules` and remove the old eth0 and wlan0 ones from there, and set the NAME of the new rules to eth0 and wlan0 (and reboot - of course I did a backup of the file first).
* I have a small own made xrand based script that extends the desktop based on how many monitors I have connected at start up. I had to modify it a bit, as the output of xrand in the Dell machine was a bit different.

Windows 7 installation was another less lucky story. As expected, Windows did not start (even in safe mode) due to very different hardware. I am aware of the [sysprep](http://technet.microsoft.com/en-us/library/cc721940.aspx) tool, but decided not to use it, due to the system customizations it removes. The Windows repair did not want to work either (it said wrong OS version, but I am sure it same disk - may be it is related to having SP1 installed?). So I decided to a new install, given I did not have much things installed in Windows anyway (only VS - I do not use Windows much nowadays at home, but it is still good to have a running copy around). Windows does not reformat by default, and the old data can be accessed, but I still backed up the few data I had there (from Lubuntu) to be sure. After re-install, I had to get the right drivers from the Dell web site. For some reason, the wireless driver cannot be downloaded from there, and after looking up the model in Google, I downloaded directly the Intel driver. After all hardware was working, the usual Windows painful procedure starts, install SP1 (which is relatively fast on a SSD) and then all the infinite window updates (I do not get why they never made an SP2 to save people from having to do pick all updates via windows update). Apart of the invested time, everything went ok. To reset Grub, I was lazy to make a live Ubuntu USB and boot from there, so I installed EasyBCD and added first an entry for Lubuntu to the Windows boot menu. Once in Lubuntu, I reinstalled Grub (using: `grub-install /dev/sda`, I did also a `update-grub` before and after that). Once Grub was there, I removed the Ubuntu BCD entry from Windows boot menu.

<ins class='nfooter'><a id='fprev' href='#blog/2014/2014-11-14-A-Minimal-GitHub-Static-Site.md'>A Minimal GitHub Static Site</a> <a id='fnext' href='#blog/2014/2014-09-15-Msbuild-MsDeploy-Generated-SourceManifest.md'>Msbuild MsDeploy Generated SourceManifest</a></ins>
